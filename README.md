# Паттерны поддержания консистентности

### Задание
Реализовать сервис заказа, сервис биллинга, сервис нотификаций.
При создании пользователя, необходимо создавать аккаунт в сервисе биллинга. 

В сервисе биллинга должна быть возможность положить деньги на аккаунт и снять деньги.

Сервис нотификаций позволяет отправить сообщение на email и позволяет получить список сообщений по методу API.

Пользователь может создать заказ. У заказа есть параметр - цена заказа.

Заказ происходит в 2 этапа:
1. Сначала снимаем деньги с пользователя с помощью сервиса биллинга.
2. Отсылаем пользователю сообщение на почту с результатами оформления заказа. Если биллинг подтвердил платеж, должно отослаться письмо счастья. Если нет, то письмо горя.
* Упрощаем и считаем, что ничего плохого с сервисами происходить не может (они не могут падать и т.д.). Сервис нотификаций на самом деле не отправляет, а просто сохраняет в БД.

### Теоритическая часть
Спроектировать взаимодействие сервисов при создании заказов. 
Предоставить варианты взаимодействий в следующих стилях в виде sequence диаграммы с описанием API на IDL:
* Только HTTP взаимодействие
* Событийное взаимодействие с использование брокера сообщений для нотификаций (уведомлений)
* Event Collaboration cтиль взаимодействия с использованием брокера сообщений

### Диаграммы
![Sequence Diagrams](https://user-images.githubusercontent.com/60660331/189902157-d3b550da-fd3f-42f2-b827-4c26d657cf2a.png)

![Sequence Diagrams_Http+Broker](https://user-images.githubusercontent.com/60660331/189904487-983723c0-adfd-4afb-914b-442baaf10d6f.png)

![Sequence Diagrams_EventColabaration](https://user-images.githubusercontent.com/60660331/189903265-1ab4ee4d-96c5-4753-ba84-5e1f1ff97143.png)

Для реализации будет использован второй вариант. Так как снятие наличных и изменение статуса заказа можно делать синхронно, а отправка уведомления о заказе может происходить довольно долго и имеет смысл ее запустить асинхронно отправив сообщение в брокер с последующей отправкой письма.

### Практическая часть
Выбрать один из вариантов и реализовать его.
На выходе должны быть: 
1. Описание архитектурного решения и схема взаимодействия сервисов (в виде картинки)
2. Команда установки приложения (из helm-а или из манифестов). Обязательно указать в каком namespace нужно устанавливать.
3. Тесты постмана, которые прогоняют сценарий:
* Создать пользователя. Должен создаться аккаунт в биллинге.
* Положить деньги на счет пользователя через сервис биллинга.
* Сделать заказ, на который хватает денег.
* Посмотреть деньги на счету пользователя и убедиться, что их сняли.
* Посмотреть в сервисе нотификаций отправленные сообщения и убедиться, что сообщение отправилось.
* Сделать заказ, на который не хватает денег.
* Посмотреть деньги на счету пользователя и убедиться, что их количество не поменялось.
* Посмотреть в сервисе нотификаций отправленные сообщения и убедиться, что сообщение отправилось.
В тестах обязательно наличие {{baseUrl}} для урла с использованием домена arch.homework в качестве initial значения {{baseUrl}},
отображение данных запроса и данных ответа при запуске из командной строки с помощью newman

### Реализация


